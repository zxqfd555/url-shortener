# Нагрузочное тестирование

Наргузочное тестирование сервиса, который состоит из одного endpoint-а, который возвращает "hello world" и код 200.

Использовались Yandex.Tank и Yandex.Overload.

## Установка

  1. Взять инструкцию по установке Танка отсюда: https://overload.yandex.net/mainpage/guide#install. У меня с первого раза завелась pip-based installation.

  2. Еще понадобится модуль telegraf, чтобы получать отчет о том, что творится на машине в момент нагрузочного тестирования.
  
  2.1. .deb Скачивается отсюда: https://portal.influxdata.com/downloads
  
  2.2. Ставится:
  
  `sudo dpkg -i telegraf_1.8.1-1_amd64.deb`
  
  3. Надо конфиг для тестирования. Пример есть в инструкции по установке Overload. С конфигом запускается:
  
  `yandex-tank -c config.yaml`
  
## SLO

Мы хотим, чтобы в 95 процентах случаев сервер отвечал за меньше, чем 20 ms.

## Тестирование

  1. Запускаем тестирование с заведомо большим рейтом, с которым сервер не справится. Конфиг: load_fuckup.yaml.
  
  2. Результаты: https://overload.yandex.net/127089. Примерно на 15 тысячах RPS стало плохо. Судя по графику CPU на вкладке "Monitoring", мы в конечном итоге уперлись в ресурсы CPU. Его использование последовательно расло в процессе тестирования, пока не осталось пары процентов. С тех пор время на запрос сильно увеличилось.
  
  3. Судя по результатам прошлого теста, в районе 13-14 тысяч RPS сервис должен работать довольно уверенно и в основном не тупить. Возьмем с запасом: решим что держим 13 тысяч RPS и будем это проверять. Конфиг: load_stability.yaml. Результаты запуска: https://overload.yandex.net/127090. Видим, что отвечаем на 95-перцентили даже с запасом, обычно за 3-5 ms, кроме всплеска в районе 16:20 - ноут решил уйти в режим экономии энергии и выключил экран, заблокировал машину, etc.
  
  4. Вывод: сервис держит 13K RPS.
  
## Примечания

Так как все делалось на одном ноутбуке c Intel Core i7-6600U CPU @ 2.60GHz и 16 GB памяти под Ubuntu 16.04, довольно большое влияние оказывали открытые программы. Особенно сильно мешал браузер (при открытых графиках в Overload все ломалось на 3K RPS). Поэтому на время тестирования лучше закрыть вообще все что можно.
