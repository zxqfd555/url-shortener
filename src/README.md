# Про код и архитектуру

Все как описано в корне в doc_rus в секции CAP. Единственное, на что стоит обратить внимание - демон-продлеватель и API живут в одном процессе, просто в разных потоках. Это спорное решение. С одной стороны -- если упадет демон, то упадет все. Но с другой - без необходимости писать на диск мы можем хранить в памяти map вида {slug: last_visit_time}, что очень сильно оптимизирует работу демона, особенно на больших рейтах. Также не надо писать на диск и думать о том, как забрать/почистить лог.

## Про файлы

В main.cpp находится основной код про API.

В lib/access_log находится код для внутреннего лога посещений.

В lib/config находится конфиг. Его, если двигаться дальше, надо конечно задавать не через код, а каким-нибудь yaml-файлом и через командную строку при запуске указывать.

В lib/daemon находится демон-продлеватель ссылок.

В lib/manager находится обертка над базой для работы со ссылками. Хороша тем, что базу можно подменить и оставить интерфейс - в основном коде ничего не поменяется.

В lib/slug находятся интерфейс и генераторы slug-ов для ссылок. Их два: обычный рандомный и последовательный. Последовательный - это последовательные slug-и 1, 2, 3, 4, ... Передается manager-у через dependency injection.

В lib/util находятся какие-то общие вспомогательные вещи.
